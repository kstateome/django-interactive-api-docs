{% extends "api_docs/base.html" %}

{% block extra_head %}
<script>
$(document).ready(function() {
   $('.action').hide();
   
   $('.api_heading').click(function(){
       $(this).parent().children('.action').slideToggle('slow');	  
   });
   $('.clear').click(function(){
       $(this).parent().children('.response').empty();	  
   });
   {% for api in apis %}
       {% for apiobj in api.apiobject_set.all %}
	   {% for method in apiobj.apimethod_set.all %}
	   $('#call_{{ method.slug }}').click(function(){
	       {% if method.parameter.all %}
		   var param_url = "?";
		   var api_url = "{{ method.api_url }}";
		   {% for param in method.parameter.all %}
		   {% if param.type == 'text' %}
		       var var_{{ param.name }} = $('input#{{ method.slug }}_{{ param.name }}').val();
		       if (var_{{ param.name }} == '')
		       {
			   var_{{ param.name }} = "{{ param.default_value }}";
		       }
		       {% if param.get_or_url == 'get' %}
		       param_url = param_url + "{{ param.name }}=" + {{ param.name }} + "";
		       {% endif %}
		       {% if param.get_or_url == 'url' %}
		       api_url = api_url + "/" + {{ param.name }};
		       
		       {% endif %}
		   {% endif %}
		   {% endfor %}
		   
	       {% endif %}
	       var call_url = api_url + param_url;
	       $(this).parent().children('pre').replaceWith("<pre>{{ method.get_type_display }}: <a href='" + call_url + "'>" + call_url + "</a></pre>");
	       
	      //$.ajax({
		// url: call_url,
		 //dataType: 'jsonp',
		 //type: '{{ method.get_type_display }}',
		 {% if method.type == 'post' %}
		 //data: { {% for param in method.parameter.all %} {% if param.type != 'no_input' %} {{ param.name }}: var_{{ param.name }}, {% endif %} {% endfor %} },
		 {% endif %}
		 //success: function(data){
		 //  $('<h6>Response</h6><pre>' + JSON.stringify(data) + '</pre>').appendTo('#{{ method.slug }}_response')
		 //}
	      //});
	      $.post(call_url, {name: 'fuck'}, function(data) {
		 $('.result').html(data);
		 });
	      
	   });
	   {% endfor %}
       {% endfor %}
   {% endfor %}
 });
		 </script>
{% endblock %}
{% block extra_section %} class="single_page"{% endblock %}
{% block main_content %}
<h1>Derek.Stegelman.Com.API</h1>
			<aside>
			<h2>General API Info</h2>
			<dl>
				<dt>Formats</dt>
				<dd>JSON, XML</dd>
				<dt>Interface</dt>
				<dd>REST</dd>
				<dt>Ordering</dt>
				<dd>By ID</dd>
				
			</dl>
			</aside>
			<article class="api_info">
				<h2>Philosophy</h2>
                                <p>I've released several APIs of data from my personal site with
                                much more to come.  I've got a pretty strong philosophy on API development that
                                I hope to evangelize and discuss on this site.</p>
                                <h3>Formats</h3>
                                <p>APIs should return JSON by default with XML as an option, but should be
                                discouraged from use as much as possible.  JSON is faster, and more lightweight than XML,
                                and considering that many developers use javascript to consume APIs, what could be better
                                than receiving an object back?</p>
                                <h3>Interface</h3>
                                <p>Long gone are the days of SOAP and other crappy implmenations of http based APIs.  Why
                                all the fuss over schemas, methods, and properties, when you can just send an HTTP string with a given
                                header and receive the data you exepect?  Seriously, REST is the only method you'll see me using.</p>
			</article>
                        {% for api in apis %}
			<h3 class="api_title">{{ api.name }}</h3>
                        {% for api_thing in api.apiobject_set.all %}
			<article class="api">
			<p></p>
			<h4 class="section_title">{{ api_thing.name }}</h4>
                        {% for method in api_thing.apimethod_set.all %}
			<section>
                                <div class="api_heading">
				<h5 class="{{ method.type }}">{{ method.get_type_display }}</h5>
				<h4>{{ method.short_description }}</h4>
				<span>{{ method.display_url	 }}</span>
                                </div>
				<p>{{ method.description }}</p>
				<div class="action" id="action_{{ method.slug }}">
					
                                        {% if method.parameter.all %}
                                        <h6>Parameters</h6>
					<table>
					<thead>
					<tr>
						<th>Parameter</th>
						<th>Value</th>
						<th>Required</th>
						<th>Type</th>
						<th>Description</th>
                                                <th>Default</th>
					</tr>
					</thead>
                                        {% for param in method.parameter.all %}
					<tr>
						<td>{{ param.name }}</td>
						<td>
                                                    {% if param.type == 'text' %}
                                                    <input type="text" name="{{ method.slug }}_{{ param.name }}" id="{{ method.slug }}_{{ param.name }}">
                                                    {% endif %}
                                                    {% if param.type == 'no_input' %}
                                                    {{ param.default_value }}
                                                    {% endif %}
                                                    
                                                </td>
						<td>{{ param.required|yesno:"Yes,No" }}</td>
						<td>{{ param.var_type }}</td>
						<td>{{ param.description }}</td>
                                                <td>{{ param.default_value }}</td>
					</tr>
                                        {% endfor %}
					
					</table>
                                        
                                        {% endif %}
                                        
                                        
                                        <a class="button positive" id="call_{{ method.slug }}">Call this method</a><a class="button clear">Clear</a>
					<h6>Call</h6>
					<pre>{{ method.get_type_display }}: <a href="{{ method.api_url }}">{{ method.api_url }}</a></pre>
					
					<div id="{{ method.slug }}_response" class="response">
                                            
					</div>
				</div>
			</section>
                        {% endfor %}
                        
			
			</article>
                        {% endfor %}
                        {% endfor %}
			
            {% endblock %}